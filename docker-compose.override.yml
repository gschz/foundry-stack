# ==============================================================================
# ARCHIVO DE CONFIGURACIÓN PARA DESARROLLO
# ==============================================================================
#
# Este archivo contiene configuraciones específicas para el entorno de desarrollo.
# Docker Compose lo aplica automáticamente sobre 'docker-compose.yml'.

services:
  backend:
    volumes:
      - ./backend:/var/www/backend
      - ./database:/var/www/database
      - ./.envs/.env.docker:/var/www/.env.docker:ro

  # ==========================================================================
  # CONFIGURACIÓN LEGACY - NO EN USO ACTUALMENTE
  # ==========================================================================
  # Esta configuración está deshabilitada porque actualmente el frontend
  # se ejecuta directamente en el host con "bun run dev:fe" como muestra
  # el comando dk:dev en package.json que ejecuta dev:fe:docker en el host.
  # Mantenemos esta configuración como referencia por si se desea volver
  # a contenedorizar el frontend en el futuro.
  #
  #   frontend:
  #     build:
  #       context: .
  #       dockerfile: docker/frontend/Dockerfile
  #     container_name: fs-frontend
  #     volumes:
  #       - ./frontend:/app/frontend
  #       - ./backend:/app/backend
  #       - /app/frontend/node_modules
  #     ports:
  #       - "5173:5173"
  #     networks:
  #       - fs-network
  #     command: bun run dev:docker
  #
  # ==========================================================================

  nginx:
    volumes:
      - ./backend:/var/www/backend # Necesario para que Nginx acceda a assets públicos en desarrollo

  db:
    ports:
      - "5432:5432" # Exponer puerto de PostgreSQL solo para desarrollo

  # Servicio de administración de PostgreSQL (pgAdmin)
  pgadmin:
    build:
      context: .
      dockerfile: docker/pgadmin/Dockerfile
    container_name: fs-pgadmin
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "5050:80" # Acceder vía http://localhost:5050
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD}
    networks:
      - fs-network
    volumes:
      - pgadmin-data:/var/lib/pgadmin
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          cpus: "0.25"
          memory: "256M"
        reservations:
          memory: "64M"
    restart: unless-stopped

volumes:
  pgadmin-data:
    driver: local
